{% macro generate_type_info(t, attr_name, nested=False) %}
{% set type_tag_id = t | tag_id %}
{% if nested %}
{% set type_tag_id = type_tag_id | add_uuid %}
{% endif %}
<p class="fw-bold {{ 'deprecated d-none' if t | is_deprecated else '' }}" style="{{ 'color: gray'  if t | is_deprecated else '' }}" data-toggle="tooltip" data-placement="top" title="{{ t | tooltip }}">
<a
      data-bs-toggle="collapse"
      href="javascript:void";
      data-target="#{{ type_tag_id }}"
      onclick="toggleCollapse(event, '{{ type_tag_id}}')"
      role="button"
      aria-expanded="false"
      aria-controls="{{ type_tag_id }}"
      >+</a>
{% if not t | is_array %}
{% if nested %}
<a href="{{ t | url_from_type }}">{{ t.full_name }} (v{{t.version[0]}}.{{t.version[1]}})</a>
{{ attr_name }}
{% else %}
{{ t.full_name }} (v{{t.version[0]}}.{{t.version[1]}}) {{ attr_name }}
{% endif %}
{% if not t | is_service %}
<span class="extent" style="color: green">[extent {{ t | extent }} bytes]</span>
{% else %}
<span class="service" style="color: blue">[service]</span>
{% endif %}
{% if t.has_fixed_port_id %}
<span class="portID" style="color: orange">[fixed port-ID {{ t.fixed_port_id }}]</span>
{% endif %}
{% if t | is_deprecated %}
<span style="color: red">[deprecated]</span>
{% endif %}
{% else %}
{{ t | display_type }} {{ attr_name }}
{% endif %}
</p>
<div class="collapse" id="{{ type_tag_id }}" style="padding-left: 1rem; border-left: 1px solid #AAA;">
    {% if t | is_array %}
    {% if t.element_type | is_composite %}
    {{ generate_type_info(t.element_type, "", True) }}
    {% else %}
    <p class="fw-bold mb-0">{{ t.element_type }}</p>
    {% endif %}
    {% else %}
    {# We don't want to show the service docs in both the service and the request #}
    {% if t.doc and not t | is_service_req %}
    <pre class="docs">{{ t.doc }}</pre>
    {% endif %}
    {% if t.attributes | length == 0 %}
    <p>(data type is empty)</p>
    {% else %}
    {% for attr in t.attributes %}
    {% if attr.data_type | is_array %}
    {{ generate_type_info(attr.data_type, attr.name, True) }}
    {% elif attr.data_type | is_composite %}
    {{ generate_type_info(attr.data_type, attr.name, True) }}
    {% else %}
    <p class="fw-bold mb-0">
    {{ attr | display_type }}
    {% if attr | is_field %}
    {% if attr.data_type | extent % 8 == 0 %}
    <span style="color: green">[extent {{ attr.data_type | extent / 8 }} bytes]</span>
    {% else %}
    <span style="color: green">[extent {{ attr.data_type | extent }} bits]</span>
    {% endif %}
    {% endif %}
    </p>
    {% endif %}
    <pre class="docs">{{ attr.doc }}</pre>
    {% endfor %}
    {% endif %}
    {% endif %}
</div>
{% endmacro %}
